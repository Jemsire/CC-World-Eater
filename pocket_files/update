hub_id = tonumber(fs.open('/hub_id', 'r').readAll())
rednet.open('back')

print('Sending update request...')
-- WORLD EATER: Check both disk and disk2 for pocket files
-- Try disk2 first (if dual-drive setup), then fall back to disk
local pocket_files_path = '/disk2/pocket_files/'
if not fs.exists(pocket_files_path) then
    pocket_files_path = '/disk/pocket_files/'
end

rednet.broadcast(pocket_files_path, 'update_request')
local sender, message, protocal = rednet.receive('update_package')

for _, file_name in pairs(fs.list('/')) do
    if file_name ~= 'rom' and file_name ~= 'disk' and file_name ~= 'disk2' and file_name ~= 'persistent' then
        fs.delete(file_name)
    end
end

for file_name, file_contents in pairs(message) do
    file = fs.open(file_name, 'w')
    file.write(file_contents)
    file.close()
end

os.reboot()